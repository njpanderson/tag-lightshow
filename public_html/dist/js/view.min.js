webpackJsonp([1],{

/***/ 114:
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
	value: true
});

var _Communicator = __webpack_require__(41);

var _Communicator2 = _interopRequireDefault(_Communicator);

var _constants = __webpack_require__(9);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var View = function View() {
	var settings = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};

	this.settings = settings;
	this._comms = new _Communicator2.default('view', window.location.origin, {
		message: this._handleAppMessage.bind(this)
	});

	this._comms.registerGuestAddress('app', window.top);

	this.scripts = [];
};

View.prototype = {
	_handleAppMessage: function _handleAppMessage(message) {
		// console.log('message to "view"!', message);

		if (message.cmd === _constants.messageCommands.RELOAD) {
			// reload request
			// console.log('reloading...');
			// console.log(message.data);
			this.settings.container.innerHTML = message.data.markup;

			this._evalScripts();
		}
	},

	/**
  * Gather scripts (besides view script) and re-insert in order
  */
	_evalScripts: function _evalScripts() {
		var _this = this;

		this.scripts = [];

		document.querySelectorAll('.view script').forEach(function (script, index) {
			var new_script;

			new_script = document.createElement('script');
			new_script.src = script.src;
			new_script.type = script.type;
			new_script.onload = function () {
				this._loadScript(index + 1);
			}.bind(_this);

			_this.scripts.push({
				new: new_script,
				old: script
			});
		});

		this._loadScript(0);
	},

	_loadScript: function _loadScript(index) {
		if (this.scripts[index]) {
			this.scripts[index].old.parentNode.replaceChild(this.scripts[index].new, this.scripts[index].old);
		}
	}
};

exports.default = View;

/***/ }),

/***/ 293:
/***/ (function(module, exports, __webpack_require__) {

"use strict";


// require.ensure([], () => {
var View = __webpack_require__(114).default;

new View({
	container: document.querySelector('.view')
});
// }, 'view');

/***/ }),

/***/ 41:
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
	value: true
});
var localStorage = window.localStorage,
    JSON = JSON || window.JSON;

/**
 * from https://developer.mozilla.org/en-US/docs/Web/API/Web_Storage_API/Using_the_Web_Storage_API
 */
var checkStorage = function checkStorage(type) {
	try {
		var storage = window[type],
		    x = '__tag_storage_test__';
		storage.setItem(x, x);
		storage.removeItem(x);
		return true;
	} catch (e) {
		return false;
	}
};

var Communicator = function Communicator(id, origin) {
	var callbacks = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {};

	if (!checkStorage('localStorage')) {
		return false;
	}

	if (typeof id !== 'string') {
		throw new Error('Please choose a string-based ID for the guest.');
	}

	if (typeof origin !== 'string') {
		throw new Error('Please choose a string-based origin address.');
	}

	this._settings = {
		name: 'tag-comm-data'
	};

	this._guests = {};
	this._queue = {};
	this.id = id;

	this._origin = origin;
	this._callbacks = Object.assign({
		message: null
	}, callbacks);

	window.addEventListener('message', this._receiveMessage.bind(this), false);

	this._sendPing();
};

Communicator.prototype = {
	/**
  * Attempt to ping source window
  */
	_sendPing: function _sendPing(node) {
		var ping = this._createMessage(null, {
			ping: this.id
		});

		if (!node) {
			if (window.opener) {
				node = window.opener;
			} else if (window.top !== window) {
				node = window.top;
			}
		}

		if (node) {
			// console.log(this.id + ' >> ping!');
			this._post(node, ping);
		}
	},

	_sendPong: function _sendPong(node) {
		var pong = this._createMessage(null, {
			pong: this.id
		});

		// console.log('pong! << ' + this.id);
		this._post(node, pong);
	},

	/**
  * Registers a single guest for communication purposes.
  * @param {string} id - Guest ID. Used when sending messages.
  * @param {mixed} dest - Destination node.
  */
	registerGuestAddress: function registerGuestAddress(id, dest) {
		if (typeof dest === 'undefined') {
			throw new Error('Cannot register address for ' + id + '. ' + 'A guest address DOM node, window or frame must be defined.');
		}

		if (!('postMessage' in dest)) {
			throw new Error('Communicator cannot send messages to destination. Please choose an HTMLElement ' + 'that supports the postMessage method');
		}

		if (typeof id !== 'string') {
			throw new Error('Please choose a string-based ID for the guest.');
		}

		// register local address for guest
		this._setGuestData(id, {
			id: id,
			node: dest
		});

		// start timer
		if (this.timer) {
			window.clearInterval(this.timer);
		}
	},

	/**
  * Sets or replaces the guest data.
  * @param {string} id - Guest ID.
  * @param {object} data - Guest data.
  * @private
  */
	_setGuestData: function _setGuestData(id, data) {
		if (!this._guests[id]) {
			this._guests[id] = {
				live: false,
				node: null
			};
		}

		Object.assign(this._guests[id], data);
	},

	/**
  * Sends a message to the defined guest.
  * @param {string} to - Guest ID, as stored.
  * @param {mixed} message - Any JS compatible data to send as a message.
  */
	send: function send(to, message) {
		var guest = this._getGuestById(to);

		if (guest && guest.live) {
			// post message immediately
			this._post(to, this._createMessage(message));
		} else {
			// queue message for posting
			this._addToQueue(to, message);
		}
	},

	/**
  * Adds a message to the local 'outbox' for the guest (by ID).
  */
	_addToQueue: function _addToQueue(to, message) {
		if (!this._queue[to]) {
			this._queue[to] = [];
		}

		this._queue[to].push(message);
	},

	_sendQueue: function _sendQueue(to) {
		var a;

		if (this._queue[to] && this._guests[to]) {
			// send messages in the order they were queued
			for (a = 0; a < this._queue[to].length; a += 1) {
				this._post(this._guests[to].node, this._createMessage(this._queue[to][a]));
			}

			// clear queue for this recipient
			this._queue[to] = [];
		}
	},

	/**
  * Gets a communicator guest by its ID, or returns `null`.
  * @returns {mixed} Guest data, or `null`.
  * @private
  */
	_getGuestById: function _getGuestById(id) {
		return this._guests[id] || null;
	},

	/**
  * Get a guest by known node (i.e. that registered in `this._guests`)
  * @private
  */
	_getGuestByNode: function _getGuestByNode(node) {
		var id;

		// console.group('_getGuestByNode');
		// console.log('finding', node);

		for (id in this._guests) {
			// console.log(id, this._guests[id], (this._guests[id].node === node));
			if (this._guests.hasOwnProperty(id) && this._guests[id].node === node) {
				// console.log('node found!', id);
				return this._getGuestById(id);
			}
		}
		// console.groupEnd();

		return null;
	},

	/**
  * Actually posts the message to the destination.
  * @param {string} to - Guest ID.
  * @param {mixed} message - Any JS compatible data to send as a message.
  * @private
  */
	_post: function _post(to, message) {
		var guest, node;

		if (typeof to === 'string') {
			guest = this._getGuestById(to);

			if (!guest.node) {
				throw new Error('Cannot communicate with guest "' + to + '". Has its Node address been registered?');
			}

			node = guest.node;
		} else {
			node = to;
		}

		node.postMessage(message, this._origin);
	},

	/**
  * Invoked when a live message is received.
  * @private
  */
	_receiveMessage: function _receiveMessage(event) {
		var origin = event.origin || event.originalEvent.origin,
		    source = event.source || event.originalEvent.source,
		    message = event.data,
		    guest;

		// console.group('_receiveMessage');
		// console.log('to "' + this.id + '":', event.data);
		if (origin !== location.origin) return;

		if ((message.ping || message.pong) && this._getGuestByNode(source)) {
			// received a ping/pong from valid source
			guest = message.ping || message.pong;
			// console.log(this.id, 'setting guest "', guest, '" live');
			this._setGuestLive(guest);
			this._sendQueue(guest);

			if (message.ping) {
				// pong back a ping (don't pong a pong or we'll be here forever)
				this._sendPong(source);
			}
		}

		if (this._callbacks.message && message.originalMessage) {
			this._callbacks.message(message.originalMessage);
		}

		// console.groupEnd();
	},

	_setGuestLive: function _setGuestLive(id) {
		this._setGuestData(id, {
			live: true
		});
	},

	_createMessage: function _createMessage(message, data) {
		return Object.assign({}, data, {
			host: this.id,
			originalMessage: message
		});
	}
};

exports.default = Communicator;

/***/ }),

/***/ 9:
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
	value: true
});
var actionTypes = exports.actionTypes = {
	UI_STATE: 'ui-state',
	ZONE_ADD_ATTACHMENT: 'zone-add-attachment',
	ZONE_EDIT_ATTACHMENT: 'zone-edit-attachment',
	ZONE_DETACH_ATTACHMENT: 'zone-detach-attachment',
	SET_DIALOG_MODE: 'set-dialog-mode',
	SET_ACTIVE_DROPLET: 'set-active-droplet'
};

var dialogModes = exports.dialogModes = {
	NONE: 'none',
	EDIT_DROPLET: 'edit-droplet'
};

var uiStates = exports.uiStates = {
	INITIALISING: 'initialising',
	ACTIVE: 'active'
};

var messageCommands = exports.messageCommands = {
	RELOAD: 'reload'
};

var errorCodes = exports.errorCodes = {
	NOT_A_DROPLET: 'A valid Droplet instance must be passed to DropZone#willAccept.'
};

var setLabels = exports.setLabels = {
	value: 'Value',
	attrs: 'Attributes',
	tagName: 'Tag name',
	innerHTML: 'HTML content'
};

/***/ })

},[293]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vLi9+L25qcC10YWcvc3JjL1ZpZXcuanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL3ZpZXcuanMiLCJ3ZWJwYWNrOi8vLy4vfi9uanAtdGFnL3NyYy9saWIvQ29tbXVuaWNhdG9yLmpzIiwid2VicGFjazovLy8uL34vbmpwLXRhZy9zcmMvYXNzZXRzL2NvbnN0YW50cy5qcyJdLCJuYW1lcyI6WyJWaWV3Iiwic2V0dGluZ3MiLCJfY29tbXMiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsIm9yaWdpbiIsIm1lc3NhZ2UiLCJfaGFuZGxlQXBwTWVzc2FnZSIsImJpbmQiLCJyZWdpc3Rlckd1ZXN0QWRkcmVzcyIsInRvcCIsInNjcmlwdHMiLCJwcm90b3R5cGUiLCJjbWQiLCJSRUxPQUQiLCJjb250YWluZXIiLCJpbm5lckhUTUwiLCJkYXRhIiwibWFya3VwIiwiX2V2YWxTY3JpcHRzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwiZm9yRWFjaCIsInNjcmlwdCIsImluZGV4IiwibmV3X3NjcmlwdCIsImNyZWF0ZUVsZW1lbnQiLCJzcmMiLCJ0eXBlIiwib25sb2FkIiwiX2xvYWRTY3JpcHQiLCJwdXNoIiwibmV3Iiwib2xkIiwicGFyZW50Tm9kZSIsInJlcGxhY2VDaGlsZCIsInJlcXVpcmUiLCJkZWZhdWx0IiwicXVlcnlTZWxlY3RvciIsImxvY2FsU3RvcmFnZSIsIkpTT04iLCJjaGVja1N0b3JhZ2UiLCJzdG9yYWdlIiwieCIsInNldEl0ZW0iLCJyZW1vdmVJdGVtIiwiZSIsIkNvbW11bmljYXRvciIsImlkIiwiY2FsbGJhY2tzIiwiRXJyb3IiLCJfc2V0dGluZ3MiLCJuYW1lIiwiX2d1ZXN0cyIsIl9xdWV1ZSIsIl9vcmlnaW4iLCJfY2FsbGJhY2tzIiwiT2JqZWN0IiwiYXNzaWduIiwiYWRkRXZlbnRMaXN0ZW5lciIsIl9yZWNlaXZlTWVzc2FnZSIsIl9zZW5kUGluZyIsIm5vZGUiLCJwaW5nIiwiX2NyZWF0ZU1lc3NhZ2UiLCJvcGVuZXIiLCJfcG9zdCIsIl9zZW5kUG9uZyIsInBvbmciLCJkZXN0IiwiX3NldEd1ZXN0RGF0YSIsInRpbWVyIiwiY2xlYXJJbnRlcnZhbCIsImxpdmUiLCJzZW5kIiwidG8iLCJndWVzdCIsIl9nZXRHdWVzdEJ5SWQiLCJfYWRkVG9RdWV1ZSIsIl9zZW5kUXVldWUiLCJhIiwibGVuZ3RoIiwiX2dldEd1ZXN0QnlOb2RlIiwiaGFzT3duUHJvcGVydHkiLCJwb3N0TWVzc2FnZSIsImV2ZW50Iiwib3JpZ2luYWxFdmVudCIsInNvdXJjZSIsIl9zZXRHdWVzdExpdmUiLCJvcmlnaW5hbE1lc3NhZ2UiLCJob3N0IiwiYWN0aW9uVHlwZXMiLCJVSV9TVEFURSIsIlpPTkVfQUREX0FUVEFDSE1FTlQiLCJaT05FX0VESVRfQVRUQUNITUVOVCIsIlpPTkVfREVUQUNIX0FUVEFDSE1FTlQiLCJTRVRfRElBTE9HX01PREUiLCJTRVRfQUNUSVZFX0RST1BMRVQiLCJkaWFsb2dNb2RlcyIsIk5PTkUiLCJFRElUX0RST1BMRVQiLCJ1aVN0YXRlcyIsIklOSVRJQUxJU0lORyIsIkFDVElWRSIsIm1lc3NhZ2VDb21tYW5kcyIsImVycm9yQ29kZXMiLCJOT1RfQV9EUk9QTEVUIiwic2V0TGFiZWxzIiwidmFsdWUiLCJhdHRycyIsInRhZ05hbWUiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7OztBQUFBOzs7O0FBQ0E7Ozs7QUFFQSxJQUFJQSxPQUFPLFNBQVBBLElBQU8sR0FBd0I7QUFBQSxLQUFmQyxRQUFlLHVFQUFKLEVBQUk7O0FBQ2xDLE1BQUtBLFFBQUwsR0FBZ0JBLFFBQWhCO0FBQ0EsTUFBS0MsTUFBTCxHQUFjLDJCQUFpQixNQUFqQixFQUF5QkMsT0FBT0MsUUFBUCxDQUFnQkMsTUFBekMsRUFBaUQ7QUFDOURDLFdBQVMsS0FBS0MsaUJBQUwsQ0FBdUJDLElBQXZCLENBQTRCLElBQTVCO0FBRHFELEVBQWpELENBQWQ7O0FBSUEsTUFBS04sTUFBTCxDQUFZTyxvQkFBWixDQUFpQyxLQUFqQyxFQUF3Q04sT0FBT08sR0FB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O0FBRzFCQyx1QkFBc0Isc0JBSEk7QUFJMUJDLHlCQUF3Qix3QkFKRTtBQUsxQkMsa0JBQWlCLGlCQUxTO0FBTTFCQyxxQkFBb0I7QUFOTSxDQUFwQjs7QUFTQSxJQUFNQyxvQ0FBYztBQUMxQkMsT0FBTSxNQURvQjtBQUUxQkMsZUFBYztBQUZZLENBQXBCOztBQUtBLElBQU1DLDhCQUFXO0FBQ3ZCQyxlQUFjLGNBRFM7QUFFdkJDLFNBQVE7QUFGZSxDQUFqQjs7QUFLQSxJQUFNQyw0Q0FBa0I7QUFDOUIxRixTQUFRO0FBRHNCLENBQXhCOztBQUlBLElBQU0yRixrQ0FBYTtBQUN6QkMsZ0JBQWU7QUFEVSxDQUFuQjs7QUFJQSxJQUFNQyxnQ0FBWTtBQUN4QkMsUUFBTyxPQURpQjtBQUV4QkMsUUFBTyxZQUZpQjtBQUd4QkMsVUFBUyxVQUhlO0FBSXhCOUYsWUFBVztBQUphLENBQWxCLEMiLCJmaWxlIjoidmlldy5taW4uanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgQ29tbXVuaWNhdG9yIGZyb20gJy4vbGliL0NvbW11bmljYXRvcic7XG5pbXBvcnQgeyBtZXNzYWdlQ29tbWFuZHMgfSBmcm9tICcuL2Fzc2V0cy9jb25zdGFudHMnO1xuXG52YXIgVmlldyA9IGZ1bmN0aW9uKHNldHRpbmdzID0ge30pIHtcblx0dGhpcy5zZXR0aW5ncyA9IHNldHRpbmdzO1xuXHR0aGlzLl9jb21tcyA9IG5ldyBDb21tdW5pY2F0b3IoJ3ZpZXcnLCB3aW5kb3cubG9jYXRpb24ub3JpZ2luLCB7XG5cdFx0bWVzc2FnZTogdGhpcy5faGFuZGxlQXBwTWVzc2FnZS5iaW5kKHRoaXMpXG5cdH0pO1xuXG5cdHRoaXMuX2NvbW1zLnJlZ2lzdGVyR3Vlc3RBZGRyZXNzKCdhcHAnLCB3aW5kb3cudG9wKTtcblxuXHR0aGlzLnNjcmlwdHMgPSBbXTtcbn07XG5cblZpZXcucHJvdG90eXBlID0ge1xuXHRfaGFuZGxlQXBwTWVzc2FnZTogZnVuY3Rpb24obWVzc2FnZSkge1xuXHRcdC8vIGNvbnNvbGUubG9nKCdtZXNzYWdlIHRvIFwidmlld1wiIScsIG1lc3NhZ2UpO1xuXG5cdFx0aWYgKG1lc3NhZ2UuY21kID09PSBtZXNzYWdlQ29tbWFuZHMuUkVMT0FEKSB7XG5cdFx0XHQvLyByZWxvYWQgcmVxdWVzdFxuXHRcdFx0Ly8gY29uc29sZS5sb2coJ3JlbG9hZGluZy4uLicpO1xuXHRcdFx0Ly8gY29uc29sZS5sb2cobWVzc2FnZS5kYXRhKTtcblx0XHRcdHRoaXMuc2V0dGluZ3MuY29udGFpbmVyLmlubmVySFRNTCA9IG1lc3NhZ2UuZGF0YS5tYXJrdXA7XG5cblx0XHRcdHRoaXMuX2V2YWxTY3JpcHRzKCk7XG5cdFx0fVxuXHR9LFxuXG5cdC8qKlxuXHQgKiBHYXRoZXIgc2NyaXB0cyAoYmVzaWRlcyB2aWV3IHNjcmlwdCkgYW5kIHJlLWluc2VydCBpbiBvcmRlclxuXHQgKi9cblx0X2V2YWxTY3JpcHRzOiBmdW5jdGlvbigpIHtcblx0XHR0aGlzLnNjcmlwdHMgPSBbXTtcblxuXHRcdGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoJy52aWV3IHNjcmlwdCcpLmZvckVhY2goKHNjcmlwdCwgaW5kZXgpID0+IHtcblx0XHRcdHZhciBuZXdfc2NyaXB0O1xuXG5cdFx0XHRuZXdfc2NyaXB0ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnc2NyaXB0Jyk7XG5cdFx0XHRuZXdfc2NyaXB0LnNyYyA9IHNjcmlwdC5zcmM7XG5cdFx0XHRuZXdfc2NyaXB0LnR5cGUgPSBzY3JpcHQudHlwZTtcblx0XHRcdG5ld19zY3JpcHQub25sb2FkID0gZnVuY3Rpb24oKSB7XG5cdFx0XHRcdHRoaXMuX2xvYWRTY3JpcHQoaW5kZXggKyAxKTtcblx0XHRcdH0uYmluZCh0aGlzKTtcblxuXHRcdFx0dGhpcy5zY3JpcHRzLnB1c2goe1xuXHRcdFx0XHRuZXc6IG5ld19zY3JpcHQsXG5cdFx0XHRcdG9sZDogc2NyaXB0XG5cdFx0XHR9KTtcblx0XHR9KTtcblxuXHRcdHRoaXMuX2xvYWRTY3JpcHQoMCk7XG5cdH0sXG5cblx0X2xvYWRTY3JpcHQ6IGZ1bmN0aW9uKGluZGV4KSB7XG5cdFx0aWYgKHRoaXMuc2NyaXB0c1tpbmRleF0pIHtcblx0XHRcdHRoaXMuc2NyaXB0c1tpbmRleF0ub2xkLnBhcmVudE5vZGUucmVwbGFjZUNoaWxkKFxuXHRcdFx0XHR0aGlzLnNjcmlwdHNbaW5kZXhdLm5ldyxcblx0XHRcdFx0dGhpcy5zY3JpcHRzW2luZGV4XS5vbGRcblx0XHRcdCk7XG5cdFx0fVxuXHR9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBWaWV3O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL34vbmpwLXRhZy9zcmMvVmlldy5qcyIsIi8vIHJlcXVpcmUuZW5zdXJlKFtdLCAoKSA9PiB7XG5cdGNvbnN0IFZpZXcgPSByZXF1aXJlKCduanAtdGFnL3NyYy9WaWV3JykuZGVmYXVsdDtcblxuXHRuZXcgVmlldyh7XG5cdFx0Y29udGFpbmVyOiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcudmlldycpXG5cdH0pO1xuLy8gfSwgJ3ZpZXcnKTtcblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gLi9zcmMvanMvdmlldy5qcyIsInZhciBsb2NhbFN0b3JhZ2UgPSB3aW5kb3cubG9jYWxTdG9yYWdlLFxuXHRKU09OID0gSlNPTiB8fCB3aW5kb3cuSlNPTjtcblxuLyoqXG4gKiBmcm9tIGh0dHBzOi8vZGV2ZWxvcGVyLm1vemlsbGEub3JnL2VuLVVTL2RvY3MvV2ViL0FQSS9XZWJfU3RvcmFnZV9BUEkvVXNpbmdfdGhlX1dlYl9TdG9yYWdlX0FQSVxuICovXG5jb25zdCBjaGVja1N0b3JhZ2UgPSBmdW5jdGlvbih0eXBlKSB7XG5cdHRyeSB7XG5cdFx0dmFyIHN0b3JhZ2UgPSB3aW5kb3dbdHlwZV0sXG5cdFx0XHR4ID0gJ19fdGFnX3N0b3JhZ2VfdGVzdF9fJztcblx0XHRzdG9yYWdlLnNldEl0ZW0oeCwgeCk7XG5cdFx0c3RvcmFnZS5yZW1vdmVJdGVtKHgpO1xuXHRcdHJldHVybiB0cnVlO1xuXHR9IGNhdGNoKGUpIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cbn07XG5cbnZhciBDb21tdW5pY2F0b3IgPSBmdW5jdGlvbihpZCwgb3JpZ2luLCBjYWxsYmFja3MgPSB7fSkge1xuXHRpZiAoIWNoZWNrU3RvcmFnZSgnbG9jYWxTdG9yYWdlJykpIHtcblx0XHRyZXR1cm4gZmFsc2U7XG5cdH1cblxuXHRpZiAodHlwZW9mIGlkICE9PSAnc3RyaW5nJykge1xuXHRcdHRocm93IG5ldyBFcnJvcignUGxlYXNlIGNob29zZSBhIHN0cmluZy1iYXNlZCBJRCBmb3IgdGhlIGd1ZXN0LicpO1xuXHR9XG5cblx0aWYgKHR5cGVvZiBvcmlnaW4gIT09ICdzdHJpbmcnKSB7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgY2hvb3NlIGEgc3RyaW5nLWJhc2VkIG9yaWdpbiBhZGRyZXNzLicpO1xuXHR9XG5cblx0dGhpcy5fc2V0dGluZ3MgPSB7XG5cdFx0bmFtZTogJ3RhZy1jb21tLWRhdGEnXG5cdH07XG5cblx0dGhpcy5fZ3Vlc3RzID0ge307XG5cdHRoaXMuX3F1ZXVlID0ge307XG5cdHRoaXMuaWQgPSBpZDtcblxuXHR0aGlzLl9vcmlnaW4gPSBvcmlnaW47XG5cdHRoaXMuX2NhbGxiYWNrcyA9IE9iamVjdC5hc3NpZ24oe1xuXHRcdG1lc3NhZ2U6IG51bGxcblx0fSwgY2FsbGJhY2tzKTtcblxuXHR3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcignbWVzc2FnZScsIHRoaXMuX3JlY2VpdmVNZXNzYWdlLmJpbmQodGhpcyksIGZhbHNlKTtcblxuXHR0aGlzLl9zZW5kUGluZygpO1xufTtcblxuQ29tbXVuaWNhdG9yLnByb3RvdHlwZSA9IHtcblx0LyoqXG5cdCAqIEF0dGVtcHQgdG8gcGluZyBzb3VyY2Ugd2luZG93XG5cdCAqL1xuXHRfc2VuZFBpbmc6IGZ1bmN0aW9uKG5vZGUpIHtcblx0XHR2YXIgcGluZyA9IHRoaXMuX2NyZWF0ZU1lc3NhZ2UobnVsbCwge1xuXHRcdFx0cGluZzogdGhpcy5pZFxuXHRcdH0pO1xuXG5cdFx0aWYgKCFub2RlKSB7XG5cdFx0XHRpZiAod2luZG93Lm9wZW5lcikge1xuXHRcdFx0XHRub2RlID0gd2luZG93Lm9wZW5lcjtcblx0XHRcdH0gZWxzZSBpZiAod2luZG93LnRvcCAhPT0gd2luZG93KSB7XG5cdFx0XHRcdG5vZGUgPSB3aW5kb3cudG9wO1xuXHRcdFx0fVxuXHRcdH1cblxuXHRcdGlmIChub2RlKSB7XG5cdFx0XHQvLyBjb25zb2xlLmxvZyh0aGlzLmlkICsgJyA+PiBwaW5nIScpO1xuXHRcdFx0dGhpcy5fcG9zdChub2RlLCBwaW5nKTtcblx0XHR9XG5cdH0sXG5cblx0X3NlbmRQb25nOiBmdW5jdGlvbihub2RlKSB7XG5cdFx0dmFyIHBvbmcgPSB0aGlzLl9jcmVhdGVNZXNzYWdlKG51bGwsIHtcblx0XHRcdHBvbmc6IHRoaXMuaWRcblx0XHR9KTtcblxuXHRcdC8vIGNvbnNvbGUubG9nKCdwb25nISA8PCAnICsgdGhpcy5pZCk7XG5cdFx0dGhpcy5fcG9zdChub2RlLCBwb25nKTtcblx0fSxcblxuXHQvKipcblx0ICogUmVnaXN0ZXJzIGEgc2luZ2xlIGd1ZXN0IGZvciBjb21tdW5pY2F0aW9uIHB1cnBvc2VzLlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWQgLSBHdWVzdCBJRC4gVXNlZCB3aGVuIHNlbmRpbmcgbWVzc2FnZXMuXG5cdCAqIEBwYXJhbSB7bWl4ZWR9IGRlc3QgLSBEZXN0aW5hdGlvbiBub2RlLlxuXHQgKi9cblx0cmVnaXN0ZXJHdWVzdEFkZHJlc3M6IGZ1bmN0aW9uKGlkLCBkZXN0KSB7XG5cdFx0aWYgKHR5cGVvZiBkZXN0ID09PSAndW5kZWZpbmVkJykge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0XHQnQ2Fubm90IHJlZ2lzdGVyIGFkZHJlc3MgZm9yICcgKyBpZCArICcuICcgK1xuXHRcdFx0XHQnQSBndWVzdCBhZGRyZXNzIERPTSBub2RlLCB3aW5kb3cgb3IgZnJhbWUgbXVzdCBiZSBkZWZpbmVkLidcblx0XHRcdCk7XG5cdFx0fVxuXG5cdFx0aWYgKCEoJ3Bvc3RNZXNzYWdlJyBpbiBkZXN0KSkge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0XHQnQ29tbXVuaWNhdG9yIGNhbm5vdCBzZW5kIG1lc3NhZ2VzIHRvIGRlc3RpbmF0aW9uLiBQbGVhc2UgY2hvb3NlIGFuIEhUTUxFbGVtZW50ICcgK1xuXHRcdFx0XHQndGhhdCBzdXBwb3J0cyB0aGUgcG9zdE1lc3NhZ2UgbWV0aG9kJ1xuXHRcdFx0KTtcblx0XHR9XG5cblx0XHRpZiAodHlwZW9mIGlkICE9PSAnc3RyaW5nJykge1xuXHRcdFx0dGhyb3cgbmV3IEVycm9yKCdQbGVhc2UgY2hvb3NlIGEgc3RyaW5nLWJhc2VkIElEIGZvciB0aGUgZ3Vlc3QuJyk7XG5cdFx0fVxuXG5cdFx0Ly8gcmVnaXN0ZXIgbG9jYWwgYWRkcmVzcyBmb3IgZ3Vlc3Rcblx0XHR0aGlzLl9zZXRHdWVzdERhdGEoaWQsIHtcblx0XHRcdGlkLFxuXHRcdFx0bm9kZTogZGVzdFxuXHRcdH0pO1xuXG5cdFx0Ly8gc3RhcnQgdGltZXJcblx0XHRpZiAodGhpcy50aW1lcikge1xuXHRcdFx0d2luZG93LmNsZWFySW50ZXJ2YWwodGhpcy50aW1lcik7XG5cdFx0fVxuXHR9LFxuXG5cdC8qKlxuXHQgKiBTZXRzIG9yIHJlcGxhY2VzIHRoZSBndWVzdCBkYXRhLlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gaWQgLSBHdWVzdCBJRC5cblx0ICogQHBhcmFtIHtvYmplY3R9IGRhdGEgLSBHdWVzdCBkYXRhLlxuXHQgKiBAcHJpdmF0ZVxuXHQgKi9cblx0X3NldEd1ZXN0RGF0YTogZnVuY3Rpb24oaWQsIGRhdGEpIHtcblx0XHRpZiAoIXRoaXMuX2d1ZXN0c1tpZF0pIHtcblx0XHRcdHRoaXMuX2d1ZXN0c1tpZF0gPSB7XG5cdFx0XHRcdGxpdmU6IGZhbHNlLFxuXHRcdFx0XHRub2RlOiBudWxsXG5cdFx0XHR9O1xuXHRcdH1cblxuXHRcdE9iamVjdC5hc3NpZ24odGhpcy5fZ3Vlc3RzW2lkXSwgZGF0YSk7XG5cdH0sXG5cblx0LyoqXG5cdCAqIFNlbmRzIGEgbWVzc2FnZSB0byB0aGUgZGVmaW5lZCBndWVzdC5cblx0ICogQHBhcmFtIHtzdHJpbmd9IHRvIC0gR3Vlc3QgSUQsIGFzIHN0b3JlZC5cblx0ICogQHBhcmFtIHttaXhlZH0gbWVzc2FnZSAtIEFueSBKUyBjb21wYXRpYmxlIGRhdGEgdG8gc2VuZCBhcyBhIG1lc3NhZ2UuXG5cdCAqL1xuXHRzZW5kOiBmdW5jdGlvbih0bywgbWVzc2FnZSkge1xuXHRcdHZhciBndWVzdCA9IHRoaXMuX2dldEd1ZXN0QnlJZCh0byk7XG5cblx0XHRpZiAoZ3Vlc3QgJiYgZ3Vlc3QubGl2ZSkge1xuXHRcdFx0Ly8gcG9zdCBtZXNzYWdlIGltbWVkaWF0ZWx5XG5cdFx0XHR0aGlzLl9wb3N0KHRvLCB0aGlzLl9jcmVhdGVNZXNzYWdlKG1lc3NhZ2UpKTtcblx0XHR9IGVsc2Uge1xuXHRcdFx0Ly8gcXVldWUgbWVzc2FnZSBmb3IgcG9zdGluZ1xuXHRcdFx0dGhpcy5fYWRkVG9RdWV1ZSh0bywgbWVzc2FnZSk7XG5cdFx0fVxuXHR9LFxuXG5cdC8qKlxuXHQgKiBBZGRzIGEgbWVzc2FnZSB0byB0aGUgbG9jYWwgJ291dGJveCcgZm9yIHRoZSBndWVzdCAoYnkgSUQpLlxuXHQgKi9cblx0X2FkZFRvUXVldWU6IGZ1bmN0aW9uKHRvLCBtZXNzYWdlKSB7XG5cdFx0aWYgKCF0aGlzLl9xdWV1ZVt0b10pIHtcblx0XHRcdHRoaXMuX3F1ZXVlW3RvXSA9IFtdO1xuXHRcdH1cblxuXHRcdHRoaXMuX3F1ZXVlW3RvXS5wdXNoKG1lc3NhZ2UpO1xuXHR9LFxuXG5cdF9zZW5kUXVldWU6IGZ1bmN0aW9uKHRvKSB7XG5cdFx0dmFyIGE7XG5cblx0XHRpZiAodGhpcy5fcXVldWVbdG9dICYmIHRoaXMuX2d1ZXN0c1t0b10pIHtcblx0XHRcdC8vIHNlbmQgbWVzc2FnZXMgaW4gdGhlIG9yZGVyIHRoZXkgd2VyZSBxdWV1ZWRcblx0XHRcdGZvciAoYSA9IDA7IGEgPCB0aGlzLl9xdWV1ZVt0b10ubGVuZ3RoOyBhICs9IDEpIHtcblx0XHRcdFx0dGhpcy5fcG9zdChcblx0XHRcdFx0XHR0aGlzLl9ndWVzdHNbdG9dLm5vZGUsXG5cdFx0XHRcdFx0dGhpcy5fY3JlYXRlTWVzc2FnZSh0aGlzLl9xdWV1ZVt0b11bYV0pXG5cdFx0XHRcdCk7XG5cdFx0XHR9XG5cblx0XHRcdC8vIGNsZWFyIHF1ZXVlIGZvciB0aGlzIHJlY2lwaWVudFxuXHRcdFx0dGhpcy5fcXVldWVbdG9dID0gW107XG5cdFx0fVxuXHR9LFxuXG5cdC8qKlxuXHQgKiBHZXRzIGEgY29tbXVuaWNhdG9yIGd1ZXN0IGJ5IGl0cyBJRCwgb3IgcmV0dXJucyBgbnVsbGAuXG5cdCAqIEByZXR1cm5zIHttaXhlZH0gR3Vlc3QgZGF0YSwgb3IgYG51bGxgLlxuXHQgKiBAcHJpdmF0ZVxuXHQgKi9cblx0X2dldEd1ZXN0QnlJZDogZnVuY3Rpb24oaWQpIHtcblx0XHRyZXR1cm4gdGhpcy5fZ3Vlc3RzW2lkXSB8fCBudWxsO1xuXHR9LFxuXG5cdC8qKlxuXHQgKiBHZXQgYSBndWVzdCBieSBrbm93biBub2RlIChpLmUuIHRoYXQgcmVnaXN0ZXJlZCBpbiBgdGhpcy5fZ3Vlc3RzYClcblx0ICogQHByaXZhdGVcblx0ICovXG5cdF9nZXRHdWVzdEJ5Tm9kZTogZnVuY3Rpb24obm9kZSkge1xuXHRcdHZhciBpZDtcblxuXHRcdC8vIGNvbnNvbGUuZ3JvdXAoJ19nZXRHdWVzdEJ5Tm9kZScpO1xuXHRcdC8vIGNvbnNvbGUubG9nKCdmaW5kaW5nJywgbm9kZSk7XG5cblx0XHRmb3IgKGlkIGluIHRoaXMuX2d1ZXN0cykge1xuXHRcdFx0Ly8gY29uc29sZS5sb2coaWQsIHRoaXMuX2d1ZXN0c1tpZF0sICh0aGlzLl9ndWVzdHNbaWRdLm5vZGUgPT09IG5vZGUpKTtcblx0XHRcdGlmICh0aGlzLl9ndWVzdHMuaGFzT3duUHJvcGVydHkoaWQpICYmXG5cdFx0XHRcdHRoaXMuX2d1ZXN0c1tpZF0ubm9kZSA9PT0gbm9kZSkge1xuXHRcdFx0XHQvLyBjb25zb2xlLmxvZygnbm9kZSBmb3VuZCEnLCBpZCk7XG5cdFx0XHRcdHJldHVybiB0aGlzLl9nZXRHdWVzdEJ5SWQoaWQpO1xuXHRcdFx0fVxuXHRcdH1cblx0XHQvLyBjb25zb2xlLmdyb3VwRW5kKCk7XG5cblx0XHRyZXR1cm4gbnVsbDtcblx0fSxcblxuXHQvKipcblx0ICogQWN0dWFsbHkgcG9zdHMgdGhlIG1lc3NhZ2UgdG8gdGhlIGRlc3RpbmF0aW9uLlxuXHQgKiBAcGFyYW0ge3N0cmluZ30gdG8gLSBHdWVzdCBJRC5cblx0ICogQHBhcmFtIHttaXhlZH0gbWVzc2FnZSAtIEFueSBKUyBjb21wYXRpYmxlIGRhdGEgdG8gc2VuZCBhcyBhIG1lc3NhZ2UuXG5cdCAqIEBwcml2YXRlXG5cdCAqL1xuXHRfcG9zdDogZnVuY3Rpb24odG8sIG1lc3NhZ2UpIHtcblx0XHR2YXIgZ3Vlc3QsIG5vZGU7XG5cblx0XHRpZiAodHlwZW9mIHRvID09PSAnc3RyaW5nJykge1xuXHRcdFx0Z3Vlc3QgPSB0aGlzLl9nZXRHdWVzdEJ5SWQodG8pO1xuXG5cdFx0XHRpZiAoIWd1ZXN0Lm5vZGUpIHtcblx0XHRcdFx0dGhyb3cgbmV3IEVycm9yKFxuXHRcdFx0XHRcdCdDYW5ub3QgY29tbXVuaWNhdGUgd2l0aCBndWVzdCBcIicgKyB0byArICdcIi4gSGFzIGl0cyBOb2RlIGFkZHJlc3MgYmVlbiByZWdpc3RlcmVkPydcblx0XHRcdFx0KTtcblx0XHRcdH1cblxuXHRcdFx0bm9kZSA9IGd1ZXN0Lm5vZGU7XG5cdFx0fSBlbHNlIHtcblx0XHRcdG5vZGUgPSB0bztcblx0XHR9XG5cblx0XHRub2RlLnBvc3RNZXNzYWdlKG1lc3NhZ2UsIHRoaXMuX29yaWdpbik7XG5cdH0sXG5cblx0LyoqXG5cdCAqIEludm9rZWQgd2hlbiBhIGxpdmUgbWVzc2FnZSBpcyByZWNlaXZlZC5cblx0ICogQHByaXZhdGVcblx0ICovXG5cdF9yZWNlaXZlTWVzc2FnZTogZnVuY3Rpb24oZXZlbnQpIHtcblx0XHR2YXIgb3JpZ2luID0gZXZlbnQub3JpZ2luIHx8IGV2ZW50Lm9yaWdpbmFsRXZlbnQub3JpZ2luLFxuXHRcdFx0c291cmNlID0gZXZlbnQuc291cmNlIHx8IGV2ZW50Lm9yaWdpbmFsRXZlbnQuc291cmNlLFxuXHRcdFx0bWVzc2FnZSA9IGV2ZW50LmRhdGEsXG5cdFx0XHRndWVzdDtcblxuXHRcdC8vIGNvbnNvbGUuZ3JvdXAoJ19yZWNlaXZlTWVzc2FnZScpO1xuXHRcdC8vIGNvbnNvbGUubG9nKCd0byBcIicgKyB0aGlzLmlkICsgJ1wiOicsIGV2ZW50LmRhdGEpO1xuXHRcdGlmIChvcmlnaW4gIT09IGxvY2F0aW9uLm9yaWdpbilcblx0XHRcdHJldHVybjtcblxuXHRcdGlmICgobWVzc2FnZS5waW5nIHx8IG1lc3NhZ2UucG9uZykgJiYgdGhpcy5fZ2V0R3Vlc3RCeU5vZGUoc291cmNlKSkge1xuXHRcdFx0Ly8gcmVjZWl2ZWQgYSBwaW5nL3BvbmcgZnJvbSB2YWxpZCBzb3VyY2Vcblx0XHRcdGd1ZXN0ID0gbWVzc2FnZS5waW5nIHx8IG1lc3NhZ2UucG9uZztcblx0XHRcdC8vIGNvbnNvbGUubG9nKHRoaXMuaWQsICdzZXR0aW5nIGd1ZXN0IFwiJywgZ3Vlc3QsICdcIiBsaXZlJyk7XG5cdFx0XHR0aGlzLl9zZXRHdWVzdExpdmUoZ3Vlc3QpO1xuXHRcdFx0dGhpcy5fc2VuZFF1ZXVlKGd1ZXN0KTtcblxuXHRcdFx0aWYgKG1lc3NhZ2UucGluZykge1xuXHRcdFx0XHQvLyBwb25nIGJhY2sgYSBwaW5nIChkb24ndCBwb25nIGEgcG9uZyBvciB3ZSdsbCBiZSBoZXJlIGZvcmV2ZXIpXG5cdFx0XHRcdHRoaXMuX3NlbmRQb25nKHNvdXJjZSk7XG5cdFx0XHR9XG5cdFx0fVxuXG5cdFx0aWYgKHRoaXMuX2NhbGxiYWNrcy5tZXNzYWdlICYmIG1lc3NhZ2Uub3JpZ2luYWxNZXNzYWdlKSB7XG5cdFx0XHR0aGlzLl9jYWxsYmFja3MubWVzc2FnZShtZXNzYWdlLm9yaWdpbmFsTWVzc2FnZSk7XG5cdFx0fVxuXG5cdFx0Ly8gY29uc29sZS5ncm91cEVuZCgpO1xuXHR9LFxuXG5cdF9zZXRHdWVzdExpdmU6IGZ1bmN0aW9uKGlkKSB7XG5cdFx0dGhpcy5fc2V0R3Vlc3REYXRhKGlkLCB7XG5cdFx0XHRsaXZlOiB0cnVlXG5cdFx0fSk7XG5cdH0sXG5cblx0X2NyZWF0ZU1lc3NhZ2U6IGZ1bmN0aW9uKG1lc3NhZ2UsIGRhdGEpIHtcblx0XHRyZXR1cm4gT2JqZWN0LmFzc2lnbih7fSwgZGF0YSwge1xuXHRcdFx0aG9zdDogdGhpcy5pZCxcblx0XHRcdG9yaWdpbmFsTWVzc2FnZTogbWVzc2FnZVxuXHRcdH0pO1xuXHR9XG59O1xuXG5leHBvcnQgZGVmYXVsdCBDb21tdW5pY2F0b3I7XG5cblxuLy8gV0VCUEFDSyBGT09URVIgLy9cbi8vIC4vfi9uanAtdGFnL3NyYy9saWIvQ29tbXVuaWNhdG9yLmpzIiwiZXhwb3J0IGNvbnN0IGFjdGlvblR5cGVzID0ge1xuXHRVSV9TVEFURTogJ3VpLXN0YXRlJyxcblx0Wk9ORV9BRERfQVRUQUNITUVOVDogJ3pvbmUtYWRkLWF0dGFjaG1lbnQnLFxuXHRaT05FX0VESVRfQVRUQUNITUVOVDogJ3pvbmUtZWRpdC1hdHRhY2htZW50Jyxcblx0Wk9ORV9ERVRBQ0hfQVRUQUNITUVOVDogJ3pvbmUtZGV0YWNoLWF0dGFjaG1lbnQnLFxuXHRTRVRfRElBTE9HX01PREU6ICdzZXQtZGlhbG9nLW1vZGUnLFxuXHRTRVRfQUNUSVZFX0RST1BMRVQ6ICdzZXQtYWN0aXZlLWRyb3BsZXQnXG59O1xuXG5leHBvcnQgY29uc3QgZGlhbG9nTW9kZXMgPSB7XG5cdE5PTkU6ICdub25lJyxcblx0RURJVF9EUk9QTEVUOiAnZWRpdC1kcm9wbGV0J1xufTtcblxuZXhwb3J0IGNvbnN0IHVpU3RhdGVzID0ge1xuXHRJTklUSUFMSVNJTkc6ICdpbml0aWFsaXNpbmcnLFxuXHRBQ1RJVkU6ICdhY3RpdmUnXG59O1xuXG5leHBvcnQgY29uc3QgbWVzc2FnZUNvbW1hbmRzID0ge1xuXHRSRUxPQUQ6ICdyZWxvYWQnXG59O1xuXG5leHBvcnQgY29uc3QgZXJyb3JDb2RlcyA9IHtcblx0Tk9UX0FfRFJPUExFVDogJ0EgdmFsaWQgRHJvcGxldCBpbnN0YW5jZSBtdXN0IGJlIHBhc3NlZCB0byBEcm9wWm9uZSN3aWxsQWNjZXB0Lidcbn07XG5cbmV4cG9ydCBjb25zdCBzZXRMYWJlbHMgPSB7XG5cdHZhbHVlOiAnVmFsdWUnLFxuXHRhdHRyczogJ0F0dHJpYnV0ZXMnLFxuXHR0YWdOYW1lOiAnVGFnIG5hbWUnLFxuXHRpbm5lckhUTUw6ICdIVE1MIGNvbnRlbnQnXG59O1xuXG5cbi8vIFdFQlBBQ0sgRk9PVEVSIC8vXG4vLyAuL34vbmpwLXRhZy9zcmMvYXNzZXRzL2NvbnN0YW50cy5qcyJdLCJzb3VyY2VSb290IjoiIn0=